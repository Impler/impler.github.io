
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Impler&#39;s Zone">
    <title>Impler&#39;s Zone</title>
    <meta name="author" content="Impler">
    
    
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="Impler's Zone">
<meta property="og:url" content="https://impler.github.io/index.html">
<meta property="og:site_name" content="Impler's Zone">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Impler's Zone">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Impler&#39;s Zone</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/07/24/MyBatis-TypeHandler/">
                            MyBatis TypeHandler
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-07-24T12:06:53+08:00">
	
		    7月 24, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="StartFromZero-MyBatis"><a href="#StartFromZero-MyBatis" class="headerlink" title="StartFromZero-MyBatis"></a>StartFromZero-MyBatis</h1><h2 id="MyBatis-TypeHandler"><a href="#MyBatis-TypeHandler" class="headerlink" title="MyBatis TypeHandler"></a>MyBatis TypeHandler</h2><p><em>draft:</em></p>
<ul>
<li>功能介绍</li>
<li>handler接口解读，包括typehandler接口、typeregistry、</li>
<li>内置typehandler</li>
<li>自定义typehandler</li>
<li>注册typehandler</li>
<li>不足：无法创建带有有参构造的handler，解决办法</li>
<li>处理resultset的完整流程</li>
</ul>
<h3 id="TypeHandler简介"><a href="#TypeHandler简介" class="headerlink" title="TypeHandler简介"></a>TypeHandler简介</h3><p>现实业务中，Java对象与数据库表字段之间并不是完全匹配的，可能表中存储的只是Java对象的一个具有代表性的属性值。这样在通过JDBC进行数据库操作时，就涉及怎样把Java对象存储到数据库，怎样把数据库中某个字段的值对应上某个Java对象的问题。<br>预编译的SQL语句对象<code>PreparedStatement</code>提供了多个设置不同类型参数的方法，如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">setObject(<span class="keyword">int</span> parameterIndex, Object x, <span class="keyword">int</span> targetSqlType)</div><div class="line">setString(<span class="keyword">int</span> parameterIndex, String x)</div><div class="line">setInt(<span class="keyword">int</span> parameterIndex, <span class="keyword">int</span> x)</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>同样的结果集对象<code>ResultSet</code>提供了获取不同类型参数值得方法，如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">getObject(String columnLabel) </div><div class="line">getString(String columnLabel)</div><div class="line">getInt(String columnLabel)</div></pre></td></tr></table></figure></p>
<p>MyBatis作为优秀的持久层框架，不可能让使用者针对不同的业务场景写这些底层枯燥臃肿的代码。MyBatis提供了类型转换的机制，统一针对具体的类型设定具体的类型处理器，使用者只需要关心如何在Java类与类型处理器之间进行映射即可。此外，MyBatis内置了大量的类型处理器类，几乎涵盖了所有常见的Java类型。使用者可以视具体情况自定义具体的类型处理器。  </p>
<h3 id="TypeHandler接口"><a href="#TypeHandler接口" class="headerlink" title="TypeHandler接口"></a>TypeHandler接口</h3><h4 id="TypeHandler接口-1"><a href="#TypeHandler接口-1" class="headerlink" title="TypeHandler接口"></a>TypeHandler接口</h4><p><img src="StartFromZero-MyBatis/resources/images/TypeHandler-TypeHandler.png" alt="TypeHandler类图" title="TypeHandler类图"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TypeHandler</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, T parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line">  <span class="function">T <span class="title">getResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line">  <span class="function">T <span class="title">getResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line">  <span class="function">T <span class="title">getResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="BaseTypeHandler接口"><a href="#BaseTypeHandler接口" class="headerlink" title="BaseTypeHandler接口"></a>BaseTypeHandler接口</h4><p><img src="StartFromZero-MyBatis/resources/images/TypeHandler-BaseTypeHandler.png" alt="BaseTypeHandler类图" title="BaseTypeHandler类图"><br><code>BaseTypeHandler</code>抽象类实现了<code>TypeHandler</code>接口，对其进一步封装，提供了预处理参数为空和结果集为空情况下的默认处理，对外细化了4个方法接口，分别为预处理参数非空处理方法，以及结果集处理的3个重载方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, T parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> T <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> T <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> T <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>;</div></pre></td></tr></table></figure></p>
<h3 id="TypeHanlder处理器类"><a href="#TypeHanlder处理器类" class="headerlink" title="TypeHanlder处理器类"></a>TypeHanlder处理器类</h3><h4 id="内置TypeHandler"><a href="#内置TypeHandler" class="headerlink" title="内置TypeHandler"></a>内置TypeHandler</h4><p>MyBatis内置的诸多TypeHandler均继承自<code>BaseTypeHanTypeHandlerdler</code>：<br><img src="https://github.com/Impler/StartFromZero-MyBatis/blob/master/resources/images/-hierarchy.png" alt="TypeHandler层级" title="TypeHandler层级">  </p>
<table>
<thead>
<tr>
<th style="text-align:left">Type Handler</th>
<th style="text-align:left">Java Types</th>
<th style="text-align:left">JDBC Types</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BooleanTypeHandler</td>
<td style="text-align:left">java.lang.Boolean,boolean</td>
<td style="text-align:left">Any compatible BOOLEAN</td>
</tr>
<tr>
<td style="text-align:left">ByteTypeHandler</td>
<td style="text-align:left">java.lang.Byte, byte</td>
<td style="text-align:left">Any compatible NUMERIC or BYTE</td>
</tr>
<tr>
<td style="text-align:left">ShortTypeHandler</td>
<td style="text-align:left">java.lang.Short, short</td>
<td style="text-align:left">Any compatible NUMERIC or SHORT INTEGER</td>
</tr>
<tr>
<td style="text-align:left">IntegerTypeHandler</td>
<td style="text-align:left">java.lang.Integer, int</td>
<td style="text-align:left">Any compatible NUMERIC or INTEGER</td>
</tr>
<tr>
<td style="text-align:left">LongTypeHandler</td>
<td style="text-align:left">java.lang.Long, long</td>
<td style="text-align:left">Any compatible NUMERIC or LONG INTEGER</td>
</tr>
<tr>
<td style="text-align:left">FloatTypeHandler</td>
<td style="text-align:left">java.lang.Float, float</td>
<td style="text-align:left">Any compatible NUMERIC or FLOAT</td>
</tr>
<tr>
<td style="text-align:left">DoubleTypeHandler</td>
<td style="text-align:left">java.lang.Double, double</td>
<td style="text-align:left">Any compatible NUMERIC or DOUBLE</td>
</tr>
<tr>
<td style="text-align:left">BigDecimalTypeHandler</td>
<td style="text-align:left">java.math.BigDecimal</td>
<td style="text-align:left">Any compatible NUMERIC or DECIMAL</td>
</tr>
<tr>
<td style="text-align:left">StringTypeHandler</td>
<td style="text-align:left">java.lang.String</td>
<td style="text-align:left">CHAR, VARCHAR</td>
</tr>
<tr>
<td style="text-align:left">ClobTypeHandler</td>
<td style="text-align:left">java.lang.String</td>
<td style="text-align:left">CHAR, VARCHAR</td>
</tr>
<tr>
<td style="text-align:left">NStringTypeHandler</td>
<td style="text-align:left">java.lang.String</td>
<td style="text-align:left">NVARCHAR, NCHAR</td>
</tr>
<tr>
<td style="text-align:left">NClobTypeHandler</td>
<td style="text-align:left">java.lang.String</td>
<td style="text-align:left">NCLOB</td>
</tr>
<tr>
<td style="text-align:left">ByteArrayTypeHandler</td>
<td style="text-align:left">byte[]</td>
<td style="text-align:left">Any compatible byte stream type</td>
</tr>
<tr>
<td style="text-align:left">BlobTypeHandler</td>
<td style="text-align:left">byte[]</td>
<td style="text-align:left">BLOB, LONGVARBINARY</td>
</tr>
<tr>
<td style="text-align:left">DateTypeHandler</td>
<td style="text-align:left">java.util.Date</td>
<td style="text-align:left">TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:left">DateOnlyTypeHandler</td>
<td style="text-align:left">java.util.Date</td>
<td style="text-align:left">DATE</td>
</tr>
<tr>
<td style="text-align:left">TimeOnlyTypeHandler</td>
<td style="text-align:left">java.util.Date</td>
<td style="text-align:left">TIME</td>
</tr>
<tr>
<td style="text-align:left">SqlTimestampTypeHandler</td>
<td style="text-align:left">java.sql.Timestamp</td>
<td style="text-align:left">TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:left">SqlDateTypeHandler</td>
<td style="text-align:left">java.sql.Date</td>
<td style="text-align:left">DATE</td>
</tr>
<tr>
<td style="text-align:left">SqlTimeTypeHandler</td>
<td style="text-align:left">java.sql.Time</td>
<td style="text-align:left">TIME</td>
</tr>
<tr>
<td style="text-align:left">ObjectTypeHandler</td>
<td style="text-align:left">Any</td>
<td style="text-align:left">OTHER, or unspecified</td>
</tr>
<tr>
<td style="text-align:left">EnumTypeHandler</td>
<td style="text-align:left">Enumeration Type</td>
<td style="text-align:left">VARCHAR any string compatible type, as the code is stored (not index)</td>
</tr>
<tr>
<td style="text-align:left">EnumOrdinalTypeHandler</td>
<td style="text-align:left">Enumeration Type</td>
<td style="text-align:left">Any compatible NUMERIC or DOUBLE, as the position is stored (not the code itself).</td>
</tr>
</tbody>
</table>
<p>StringTypeHandler实现示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, String parameter, JdbcType jdbcType)</span></span></div><div class="line">      <span class="keyword">throws</span> SQLException &#123;</div><div class="line">    ps.setString(i, parameter);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span></span></div><div class="line">      <span class="keyword">throws</span> SQLException &#123;</div><div class="line">    <span class="keyword">return</span> rs.getString(columnName);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span></span></div><div class="line">      <span class="keyword">throws</span> SQLException &#123;</div><div class="line">    <span class="keyword">return</span> rs.getString(columnIndex);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span></span></div><div class="line">      <span class="keyword">throws</span> SQLException &#123;</div><div class="line">    <span class="keyword">return</span> cs.getString(columnIndex);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="自定义TypeHandler"><a href="#自定义TypeHandler" class="headerlink" title="自定义TypeHandler"></a>自定义TypeHandler</h4><p>尽管MyBatis已经内置了大量的类型处理器，但也可能会有无法满足实际业务需要的情况出现，此时就需要自定义类型处理器。<br>就处理枚举类型来讲，虽然MyBatis提供了<code>EnumOrdinalTypeHandler</code>、<code>EnumTypeHandler</code>两个类型处理器，但简单分析他们的功能后发现并不能很好的匹配实际需求。<br><code>EnumOrdinalTypeHandler</code>顾名思义，即使用枚举变量的ordinal属性进行设置参数和结果集与枚举类型映射。ordinal属性为枚举变量定义的顺序，从0开始（详细的介绍请查阅Java Doc）。<br>下面来看下核心代码段：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumOrdinalTypeHandler</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">E</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">EnumOrdinalTypeHandler</span><span class="params">(Class&lt;E&gt; type)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.type = type;</div><div class="line">    <span class="keyword">this</span>.enums = type.getEnumConstants();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, E parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    <span class="comment">// ordinal作为参数值</span></div><div class="line">	ps.setInt(i, parameter.ordinal());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> E <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    <span class="keyword">int</span> i = rs.getInt(columnName);</div><div class="line">	<span class="comment">// ordinal作为下标获取枚举对象</span></div><div class="line">    <span class="keyword">return</span> enums[i];</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>类似的，<code>EnumTypeHandler</code>使用枚举变量名设置参数和结果集与枚举类型映射。<br>下面来看下核心代码段：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumTypeHandler</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">E</span>&gt;&gt; <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">EnumTypeHandler</span><span class="params">(Class&lt;E&gt; type)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.type = type;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, E parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    <span class="comment">// 枚举变量名作为参数</span></div><div class="line">    ps.setString(i, parameter.name());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> E <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">    String s = rs.getString(columnName);</div><div class="line">	<span class="comment">// 通过枚举变量名匹配枚举对象</span></div><div class="line">    <span class="keyword">return</span> s == <span class="keyword">null</span> ? <span class="keyword">null</span> : Enum.valueOf(type, s);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此外，细心的你可能会发现，这里介绍的<code>EnumOrdinalTypeHandler</code>、<code>EnumTypeHandler</code>与上面样例中的<code>StringTypeHandler</code>实现略有不同。前两者均包含有参构造，而后者没有。仔细想想也不难理解，<code>StringTypeHandler</code>处理的目标对象是明确的，即<code>String</code>类型；而<code>java.lang.Enum</code>是一个抽象的概念，直到具体的枚举类型被创建出来类型才能确定，所以前两者更像是枚举类型处理器工厂，需要传入具体的枚举类型才能工作。<br><code>EnumOrdinalTypeHandler</code>和<code>EnumTypeHandler</code>是站在抽象层的类型处理解决方案，虽然可能解决不了实际问题，但也可以为我们提供一定的思路。<br>枚举类型的形式多样，可以是<code>UserRole.ADMIN</code>、<code>UserRole.ADMIN(&quot;admin&quot;)</code>、<code>UserRole.ADMIN(1，&quot;admin&quot;)</code>等。我们可以抽象出实际中所用到的枚举类型的统一接口，然后面向接口创建类型处理器。<br>下面以形如<code>ADMIN(1,&quot;admin&quot;)</code>的枚举类型举例。<br>接口定义如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IGenericEnum</span> </span>&#123;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 获得枚举整型部分值，这里作为key值</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 获取枚举描述信息</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getString</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实际业务中的枚举类型：用户角色枚举类型<code>UserRoleEnum</code>、用户状态枚举类型<code>UserActiveStatusEnum</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 用户角色枚举类型</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> UserRoleEnum implements IGenericEnum&#123;</div><div class="line"></div><div class="line">	SUPERADMIN(<span class="number">1</span>, <span class="string">"superadmin"</span>),</div><div class="line">	ADMIN(<span class="number">2</span>, <span class="string">"admin"</span>),</div><div class="line">	USER(<span class="number">3</span>, <span class="string">"user"</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> roleId;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String roleName;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">UserRoleEnum</span><span class="params">(<span class="keyword">int</span> roleId, String roleName)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.roleId = roleId;</div><div class="line">		<span class="keyword">this</span>.roleName = roleName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> roleId;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> roleName;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 用户状态枚举类型</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> UserActiveStatusEnum implements IGenericEnum&#123;</div><div class="line">	<span class="comment">// 未激活状态</span></div><div class="line">	INACTIVE(<span class="number">0</span>, <span class="string">"inactive"</span>),</div><div class="line">	<span class="comment">// 已激活状态</span></div><div class="line">	ACTIVE(<span class="number">1</span>, <span class="string">"active"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> key;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String value;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">UserActiveStatusEnum</span><span class="params">(<span class="keyword">int</span> key, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.key = key;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.key;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>UserActiveStatusEnum</code>类型对应用户表的<code>ROLE  tinyint(1)</code>字段，<code>UserRoleEnum</code>类型对应用户表的<code>ACTIVE  tinyint(1)</code>字段。所以下面定义的类型处理器就负责为数字型的数据库列赋值、将结果集指定列中的数字型数据转换为相应的枚举类型。<br><code>IGenericEnum</code>接口的类型处理器，参考<code>EnumTypeHandler</code>的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericEnumHandler</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">IGenericEnum</span>&gt; <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Class&lt;E&gt; type;</div><div class="line">	<span class="comment">// 同样需要依赖具体的枚举类型</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GenericEnumHandler</span><span class="params">(Class&lt;E&gt; type)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (type == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Type argument cannot be null"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">this</span>.type = type;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, E parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		ps.setInt(i, parameter.getIntValue());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> E <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">		<span class="keyword">if</span> (rs.wasNull()) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">int</span> key = rs.getInt(columnName);</div><div class="line">			<span class="keyword">return</span> EnumUtil.getEnumConstant(type, key);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// 省略其他getNullableResult重载方法</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//涉及的枚举工具类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumUtil</span> </span>&#123;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 根据枚举常量的int值，取得对应的枚举对象</div><div class="line">	 * <span class="doctag">@param</span> type 枚举类class</div><div class="line">	 * <span class="doctag">@param</span> key int值</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;E extends IGenericEnum&gt; <span class="function">E <span class="title">getEnumConstant</span><span class="params">(Class&lt;E&gt; type, <span class="keyword">int</span> key)</span></span>&#123;</div><div class="line">		E[] constants = type.getEnumConstants();</div><div class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == constants)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(E c : constants)&#123;</div><div class="line">			<span class="keyword">if</span>(c.getIntValue() == key)&#123;</div><div class="line">				<span class="keyword">return</span> c;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="TypeHandler注册器-–-TypeHandlerRegistry"><a href="#TypeHandler注册器-–-TypeHandlerRegistry" class="headerlink" title="TypeHandler注册器 – TypeHandlerRegistry"></a>TypeHandler注册器 – TypeHandlerRegistry</h3><p>前面介绍了MyBatis内置了大量的类型处理器，那么这些处理器存储在哪，又是以什么方式存储的？那就要来看看<code>TypeHandlerRegistry</code>了。  </p>
<h4 id="TypeHandler的存储-TypeHandlerRegistry的内部结构"><a href="#TypeHandler的存储-TypeHandlerRegistry的内部结构" class="headerlink" title="TypeHandler的存储 TypeHandlerRegistry的内部结构"></a>TypeHandler的存储 TypeHandlerRegistry的内部结构</h4><p>TypeHandler主要存在3个Map中：  </p>
<ul>
<li>JDBC_TYPE_HANDLER_MAP：具体JDBC类型的处理器类<ul>
<li>key：JdbcType</li>
<li>value：TypeHandler</li>
</ul>
</li>
<li>TYPE_HANDLER_MAP：具体Java类型的处理器类<ul>
<li>key：Type</li>
<li>value：Map：<ul>
<li>key：JdbcType</li>
<li>value：TypeHandler</li>
</ul>
</li>
</ul>
</li>
<li>ALL_TYPE_HANDLERS_MAP：登记所有的类型处理器<ul>
<li>key：TypeHandler Class</li>
<li>value：TypeHandler</li>
</ul>
</li>
</ul>
<h4 id="TypeHandler的注册"><a href="#TypeHandler的注册" class="headerlink" title="TypeHandler的注册"></a>TypeHandler的注册</h4><p>上一节介绍了TypeHandler的存储结构，下面就来看下怎么配置TypeHandler。对于内置TypeHandler，是由MyBatis自己注册的。我们要关心的就是如何配置自定义TypeHandler。<br>主要在3个地方配置TypeHandler:  </p>
<ul>
<li>在MyBatis主配置文件中的<code>&lt;typeHandlers&gt;</code>元素中配置</li>
<li>在Mapper文件中具体列上配置</li>
<li>在自定义类型处理器上通过注解<code>@MappedTypes</code>配置</li>
</ul>
<h5 id="typeHandlers元素"><a href="#typeHandlers元素" class="headerlink" title="typeHandlers元素"></a>typeHandlers元素</h5><p>配置形式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"xxx"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"xxx"</span> <span class="attr">javaType</span>=<span class="string">"xxx"</span> <span class="attr">jdbcType</span>=<span class="string">"xxx"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"xxx"</span> <span class="attr">javaType</span>=<span class="string">"xxx"</span> <span class="attr">jdbcType</span>=<span class="string">"xxx"</span>/&gt;</span></div><div class="line">	...</div><div class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>package：待扫描的自定义类型处理器包名</li>
<li>handler：必选，自定义类型处理器的全限定类名或别名</li>
<li>javaType：可选，该类型处理器适用的Java类型</li>
<li>jdbcType：可选，该类型处理器适用的Jdbc类型</li>
</ul>
<h5 id="Mapper文件配置"><a href="#Mapper文件配置" class="headerlink" title="Mapper文件配置"></a>Mapper文件配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"xxx"</span> <span class="attr">property</span>=<span class="string">"xxx"</span> </span></div><div class="line">	<span class="attr">typeHandler</span>=<span class="string">"xxx"</span> <span class="attr">javaType</span>=<span class="string">"xxx"</span> <span class="attr">jdbcType</span>=<span class="string">"xxx"</span> /&gt;</div></pre></td></tr></table></figure>
<h5 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MappedTypes</span>(&#123;XXX.class, XXX.class&#125;)</div><div class="line"><span class="meta">@MappedJdbcTypes</span>(value=&#123;JdbcType.XXX,JdbcType.XXX&#125;,includeNullJdbcType=<span class="keyword">true</span>/<span class="keyword">false</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXX</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">XXX</span>&gt; </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="TypeHandler的注册时机"><a href="#TypeHandler的注册时机" class="headerlink" title="TypeHandler的注册时机"></a>TypeHandler的注册时机</h4><h4 id="TypeHandler的匹配"><a href="#TypeHandler的匹配" class="headerlink" title="TypeHandler的匹配"></a>TypeHandler的匹配</h4>
                    
                        
                    
                    
                        <p>
                            <a href="/2016/07/24/MyBatis-TypeHandler/#post-footer" class="postShorten-excerpt_link link">
                                注释和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/07/20/hello-world/">
                            Hello World
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-07-20T20:41:09+08:00">
	
		    7月 20, 2016
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h3 id="Hey-man-what’s-wrong-with-you…"><a href="#Hey-man-what’s-wrong-with-you…" class="headerlink" title="Hey man, what’s wrong with you…"></a>Hey man, what’s wrong with you…</h3>
                    
                        
                    
                    
                        <p>
                            <a href="/2016/07/20/hello-world/#post-footer" class="postShorten-excerpt_link link">
                                注释和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Impler. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Impler</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->



</html>
